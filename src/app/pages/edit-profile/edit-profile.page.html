<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/main/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Editar Perfil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div *ngIf="currentUser">
    <ion-list lines="full">
      <ion-item>
        <ion-label position="stacked">Nombre para mostrar</ion-label>
        <ion-input type="text" [(ngModel)]="displayName" placeholder="Tu nombre" name="displayNameInput" required>
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Biografía</ion-label>
        <ion-textarea [(ngModel)]="bio" placeholder="Cuéntanos un poco sobre ti..." name="bioInput" rows="4"
          autoGrow="true">
        </ion-textarea>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Número de teléfono</ion-label>
        <ion-input type="tel" [(ngModel)]="phoneNumber" placeholder="Ej: +54 9 11 12345678" name="phoneInput">
        </ion-input>
      </ion-item>
      <ion-item lines="none">
        <ion-label>
          <p><strong>Email:</strong> {{ currentUser.email }}</p>
          <p><small>(El email no se puede cambiar desde aquí)</small></p>
        </ion-label>
      </ion-item>
    </ion-list>
    <ion-list-header class="ion-margin-top">
      <ion-label>Ubicación</ion-label>
    </ion-list-header>
    <ion-item *ngIf="location && location.latitude && location.longitude">
      <ion-label>
        <p>Latitud: {{ location.latitude?.toFixed(5) }}</p>
        <p>Longitud: {{ location.longitude?.toFixed(5) }}</p>
      </ion-label>
    </ion-item>
    <ion-item *ngIf="!location || !location.latitude || !location.longitude">
      <ion-label>Ubicación no establecida.</ion-label>
    </ion-item>
    <ion-button expand="block" (click)="getCurrentLocation()" [disabled]="isFetchingLocation" color="secondary"
      class="ion-margin-top">
      <ion-spinner *ngIf="isFetchingLocation" name="crescent" slot="start"></ion-spinner>
      Obtener Ubicación Actual
    </ion-button>
    <ion-button expand="block" (click)="saveProfile()" [disabled]="!displayName || displayName.trim() === ''"
      class="ion-margin-top">
      Guardar Cambios
    </ion-button>

    <ion-button expand="block" (click)="saveProfile()" [disabled]="!displayName || displayName.trim() === ''"
      class="ion-margin-top">
      Guardar Cambios
    </ion-button>
  </div>

  <div *ngIf="!currentUser" class="ion-text-center ion-padding">
    <p>Cargando información del perfil...</p>
    <ion-spinner name="crescent"></ion-spinner>
  </div>
</ion-content>